<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>RXtoRINEX: Commands/src/RXtoOSP.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RXtoRINEX
   &#160;<span id="projectnumber">V2.0</span>
   </div>
   <div id="projectbrief">RXtoRINEX provides tools to collect data from GPS / GNSS receivers in mobile devices, convert them to RINEX or RTK formats, and process RINEX files.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b56bc70d6f175f70aa8be9ffda7ded2c.html">Commands</a></li><li class="navelem"><a class="el" href="dir_643c3b328fab940839eb7e9d0d28ed05.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">RXtoOSP.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_arg_parser_8h_source.html">ArgParser.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_logger_8h_source.html">Logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_utilities_8h_source.html">Utilities.h</a>&quot;</code><br />
<code>#include &quot;SerialTxRx.h&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a94323a8c4efa4d59c2d9528b955949c9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_r_xto_o_s_p_8cpp.html#a94323a8c4efa4d59c2d9528b955949c9">acquireBin</a> (SerialTxRx, FILE *, int, int, int, <a class="el" href="class_logger.html">Logger</a> *)</td></tr>
<tr class="separator:a94323a8c4efa4d59c2d9528b955949c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_r_xto_o_s_p_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains the command line program to capture OSP message data from a SiRF IV receiver and stores them in a OSP binary file. </p>
<p>Usage: </p>
<p>OSPDataLogger.exe {options} </p>
<p>Options are:</p><ul>
<li>-a PAT or &ndash;patience=PAT : Maximum number of bytes to read when waiting for a packet start (0xA0 0xA3). Default value PAT = 2500</li>
<li>-b BAUD or &ndash;baud=BAUD : Set serial port baud rate. Default value BAUD = 57600</li>
<li>-d DURATION or &ndash;duration=DURATION : Duration of acquisition period, in minutes. Default value DURATION = 5</li>
<li>-e or &ndash;ephemeris : Capture GPS ephemeris data (MID15). Default value EPHEM=TRUE</li>
<li>-f BFILE or &ndash;binfile=BFILE : OSP binary output file. Default value BFILE = 20150126_205513.OSP</li>
<li>-g or &ndash;GPS50bps : Capture GPS 50bps nav message (MID8). Default value G50BPS=FALSE</li>
<li>-h or &ndash;help : Show usage data. Default value HELP=FALSE</li>
<li>-i OBSINT or &ndash;interval=OBSINT : Observation interval (in seconds) for epoch data. Default value OBSINT = 5</li>
<li>-l LOGLEVEL or &ndash;llevel=LOGLEVEL : Maximum level to log (SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST). Default value LOGLEVEL = INFO</li>
<li>-p COMPORT or &ndash;port=COMPORT : Serial port name where receiver is connected. Default value COMPORT = COM35</li>
<li>-s MID or &ndash;stop=MID : Stop epoch data acquisition when this MID (Message ID) arrives. Default value MID = 7</li>
</ul>
<p>Copyright 2015 Francisco Cancillo </p>
<p>This file is part of the RXtoRINEX tool. </p>
<p>RXtoRINEX is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. RXtoRINEX is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. A copy of the GNU General Public License can be found at <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>Ver. |Date |Reason for change ---&mdash;+----&mdash;+---------------&mdash; V1.0 |2/2015 |First release V2.0 |2/2016 |Improve logging |Add commands for SiRFV </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a94323a8c4efa4d59c2d9528b955949c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int acquireBin </td>
          <td>(</td>
          <td class="paramtype">SerialTxRx&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>outFile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxMsgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxEpochs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>patience</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_logger.html">Logger</a> *&#160;</td>
          <td class="paramname"><em>plog</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>acquireBin acquires binary OSP messages from the receiver and record them in the binary OSP file. Data are read from the receiver and written to the OSP file until:</p><ul>
<li>the maximum number of messages is reached, or</li>
<li>the maximum number of epoch is reached, or</li>
<li>an unrecoverable error happens reading data from receiver</li>
<li>a write error happens</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>the SerialTxRx object used to communicate with the receiver </td></tr>
    <tr><td class="paramname">outFile</td><td>the binary output file to record the messages received from receiver </td></tr>
    <tr><td class="paramname">maxMsgs</td><td>the maximum number of messages to be recorded </td></tr>
    <tr><td class="paramname">maxEpochs</td><td>the maximum number of epochs to be recorded </td></tr>
    <tr><td class="paramname">patience</td><td>the maximum number of erroneous contiguous bytes to read before returning a read error </td></tr>
    <tr><td class="paramname">plog</td><td>the pinter to the <a class="el" href="class_logger.html">Logger</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a read status according to the following values and meaning:<ul>
<li>(0) no errors have been detected</li>
<li>(6) error has occurred when writing data read from receiver</li>
<li>(7) error reading data from receiver: patience exahusted or EOF </li>
</ul>
</dd></dl>
<p>The acquireBin process sequence follows:</p>
<p>1- Sets counters</p>
<p>2- Reads messages from the input stream until counts exhausted or unrecoverable error happen</p>
<ul>
<li>Log message read using format OSP&lt;MID,length&gt; Result</li>
<li>Update counters and write message to OSP file </li>
</ul>

</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>main gets the command line arguments, set parameters accordingly and triggers the data acquisition from the receiver. The SiRFIV GPS receiver shall be connected to a serial port and ready to receive and send messages. To be ready for this command, the receiver and computer shall be synchronized at the same baud rate, and the receiver sending / accepting OSP messages. </p>
<p>This command sends messages to the receiver to state the data flow with the messages and rates needed to generate OSP files that could be used for the further extraction of data used in RINEX and RTK files. </p>
<p>From the input receiver data stream, the command extracts the messages requested, verifies then, and writes the correct ones to the OSP binary file. See SiRF IV ICD for details on receiver messages. </p>
<p>The binary OSP output files containt messages where head, check and tail have been removed, that is, the data for each message consists of the two bytes of the payload length and the payload bytes. </p>
<p>The SynchroRX command line provided in this project can be used to check and set the receiver state: baud rate, accept/send OSP or NMEA messages, etc. Other utilities provided by receiver manufacturers exist that could perform this synchro task.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>the number of arguments passed from the command line </td></tr>
    <tr><td class="paramname">argv</td><td>the array of arguments passed from the command line </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the exit status according to the following values and meaning:<ul>
<li>(0) no errors have been detected</li>
<li>(1) an error has been detected in arguments</li>
<li>(2) error when opening and setting the communication port</li>
<li>(3) the receiver is not sending OSP messages</li>
<li>(4) error has occurred when setting receiver</li>
<li>(5) error has occurred when creating the binary output OSP file</li>
<li>(6) error has occurred when writing data read from receiver </li>
</ul>
</dd></dl>
<p>The main process sequence follows:</p>
<p>1- Defines and sets the error logger object</p>
<p>2- Setups the valid options in the command line. They will be used by the argument/option parser</p>
<p>3- Parses arguments in the command line extracting options and operators</p>
<p>4- Sets logging level stated in option</p>
<p>5- Computes observation interval and number of epochs to read from data given in options</p>
<p>6- Defines and sets up the SerialTxRx object to be used for communication with the receiver</p>
<p>7- Verifies that receiver mode is OSP</p>
<p>8- Sends OSP commands to the communication port to perform receiver setup</p>
<p>8- Creates the output binary file</p>
<p>9- Calls acquireBin to acquire and record data form receiver </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 3 2016 12:50:07 for RXtoRINEX by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
