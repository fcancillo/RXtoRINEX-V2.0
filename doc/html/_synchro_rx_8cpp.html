<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>RXtoRINEX: Commands/src/SynchroRx.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RXtoRINEX
   &#160;<span id="projectnumber">V2.0</span>
   </div>
   <div id="projectbrief">RXtoRINEX provides tools to collect data from GPS / GNSS receivers in mobile devices, convert them to RINEX or RTK formats, and process RINEX files.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b56bc70d6f175f70aa8be9ffda7ded2c.html">Commands</a></li><li class="navelem"><a class="el" href="dir_643c3b328fab940839eb7e9d0d28ed05.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SynchroRx.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_arg_parser_8h_source.html">ArgParser.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_logger_8h_source.html">Logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_utilities_8h_source.html">Utilities.h</a>&quot;</code><br />
<code>#include &quot;SerialTxRx.h&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_synchro_rx_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains the command line program to synchronize receiver and computer to allow reception of GPS receiver data. The current implementation of is program synchronizes Windows comm ports and SiRF IV receiver. </p>
<p>Usage: </p>
<p>SynchroRX.exe {options} </p>
<p>Options are:</p><ul>
<li>-a PAT or &ndash;patience=PAT : Maximum number of bytes to read when waiting for a packet start. Default value PAT = 500</li>
<li>-h or &ndash;help : Show usage data. Default value HELP=FALSE</li>
<li>-l LOGLEVEL or &ndash;llevel=LOGLEVEL : Maximum level to log (SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST). Default value LOGLEVEL = INFO</li>
<li>-p COMPORT or &ndash;port=COMPORT : Serial port name where receiver is connected. Default value COMPORT = COM35</li>
<li>-m MODE or &ndash;mode=MODE : Set receiver protocol to NMEA or OSP. Default value MODE = NMEA </li>
</ul>
<p>Copyright 2015 Francisco Cancillo </p>
<p>This file is part of the RXtoRINEX tool. </p>
<p>RXtoRINEX is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. RXtoRINEX is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. A copy of the GNU General Public License can be found at <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>Ver. |Date |Reason for change ---&mdash;+----&mdash;+---------------&mdash; V1.0 |2/2015 |First release V1.1 |2/2016 |Minor improvements for logging messages </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>main sets the communication between computer and receiver at the speed and mode requested. </p>
<p>The receiver state is defined by the following:</p><ul>
<li>The serial port bit rate, stop bits, and parity it is using</li>
<li>The protocol mode it is using to send data: NMEA or OSP</li>
<li>If data is flowing from the receiver or not </li>
</ul>
<p>The computer data acquisition process state is defined by:</p><ul>
<li>The serial port (port name) it is using for the communication with the GPS receiver</li>
<li>The serial port bit rate, stop bits, and parity being used</li>
<li>The type of data expected: NMEA or OSP </li>
</ul>
<p>To allow communication between GPS receiver and computer, states of both elements shall be synchronized according to the needs stated. To synchronize computer and receiver their current states shall be known, and changed if different. </p>
<p>To know the receiver state is necessary to communicate with it, setting first the computer port at the same speed, stop bits and parity that the receiver. This will allow receiving and analyzing the data being generated by the receiver to know the protocol it is using. </p>
<p>As receiver state may be not known initially, it would be necessary to scan at different speeds data being received to identify the protocol. </p>
<p>To allow synchronization it is assumed the following for the receiver:</p><ul>
<li>It is providing data continuously, ASCII NMEA or binary OSP messages, depending on the mode.</li>
<li>It is receiving/sending data at 1200, 2400, 4800, 9600, 38400, 57600 or 115200 bps, with one stop bit and parity none. </li>
</ul>
<p>After synchronization, bit rates will be set to 9600 bps when exchanging NMEA data or to 57600 bps when exchanging OSP messages..</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>the number of arguments passed from the command line </td></tr>
    <tr><td class="paramname">argv</td><td>array with argument values passed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the exit status according to the following values and meaning:<ul>
<li>(0) Receiver protocol mode changed to requested value (OSP or NMEA). Baud rate set accordingly.</li>
<li>(1) Error in the command line arguments passed to the program</li>
<li>(2) An error occurred when setting computer port parameters, or when sending or reciving data. See log file for details.</li>
<li>(3) Unable to change to the protocol mode requested. See log file for details. </li>
</ul>
</dd></dl>
<p>The main process sequence follows:</p>
<p>1- Defines and sets the error logger object</p>
<p>2- Setups the valid options in the command line. They will be used by the argument/option parser</p>
<p>3- Parses arguments in the command line extracting options and operators</p>
<p>4- Sets logging level stated in option</p>
<p>5- Gets from option the protocol mode to be used</p>
<p>6 - Checks current computer baud rate</p>
<p>6 - Discover initial receiver mode and baud rate, first look for "most likely" ones:</p><ul>
<li>if the computer computer baud rate is not the NMEA or OSP one, set the NMEA rate</li>
<li>if computer baud rate is the NMEA one, check if receiver is sending NMEA messages</li>
<li>if computer baud rate is the OSP one, check if receiver is sending OSP messages</li>
</ul>
<p>9- When failed to discover receiver mode at usual baud rates, iterate over all baud rates setting computer port speed and sending NMEA and OSP commands to set its mode to OSP at 57600 bps. Then checks if the current receiver mode has changed to OSP.</p>
<p>10- If the current receiver mode is OSP, but it is wanted to be NMEA, sends a OSP command to change it, and sets computer com speed at NMEAbRate. Then checks if new mode has changed to NMEA.</p>
<p>11- If the current receiver mode is NMEA, but it is wanted to be OSP, sends a NMEA command to change it, and sets computer com speed at OSPbRate Then checks if new mode has changed to OSP.</p>
<p>12- Verify if the resulting current mode is the wanted one, and returns value accordingly </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 3 2016 12:50:07 for RXtoRINEX by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
